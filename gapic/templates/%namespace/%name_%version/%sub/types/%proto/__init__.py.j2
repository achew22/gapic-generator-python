{% extends "_base.py.j2" %}

{% block content %}

{% with p = proto.disambiguate('proto') %}
{% if proto.messages|length or proto.all_enums|length %}
import proto{% if p != 'proto' %} as {{ p }}{% endif %}  # type: ignore
{% endif %}

{% filter sort_lines %}
{% for import_ in proto.python_modules %}
{{ import_ }}
{% endfor %}
{% endfilter %}


__protobuf__ = {{ p }}.module(
    package='{{ '.'.join(proto.meta.address.package) }}',
    {% if api.naming.proto_package != '.'.join(proto.meta.address.package) %}
    marshal='{{ api.naming.proto_package }}',
    {% endif %}
    manifest={
    {% for enum in proto.enums.values() %}
        '{{ enum.name }}',
    {% endfor %}
    {% for message in proto.messages.values() %}
        '{{ message.name }}',
    {% endfor %}
    },
)

{% if has_requests %}
from .requests import (
    {% for enum in proto.enums.values() %}
        {% if enum.name.endswith('Request') %}
        {{enum.name}},
        {% endif %}
    {% endfor %}
    {% for message in proto.messages.values() %}
        {% if message.name.endswith('Request') %}
        {{message.name}},
        {% endif %}
    {% endfor %}
)
{% endif %}

{% if has_responses %}
from .responses import (
    {% for enum in proto.enums.values() %}
        {% if enum.name.endswith('Response') %}
        {{enum.name}},
        {% endif %}
    {% endfor %}
    {% for message in proto.messages.values() %}
        {% if message.name.endswith('Response') %}
        {{message.name}},
        {% endif %}
    {% endfor %}
)
{% endif %}

{% for enum in proto.enums.values() %}
    {% if not (enum.name.endswith('Request') or enum.name.endswith('Response')) %}
    {% include '%namespace/%name_%version/%sub/types/_enum.py.j2' with context %}
    {% endif %}
{% endfor %}

{% for message in proto.messages.values() %}
    {% if not (message.name.endswith('Request') or message.name.endswith('Response')) %}
    {% include "%namespace/%name_%version/%sub/types/_message.py.j2" with context %}
    {% endif %}
{% endfor %}
{% endwith %}

class _MagicProtoCompletion_{{'_'.join(proto.meta.address.package)}}(proto.Message):
    """
    This is magic. This class needs to be here, so the Metaclass-proto-miracle-workings
    could properly construct all the protobuf classes and pretend like if they were from
    this file and not from other/requests/responses.py.
    """
    pass

__all__ = tuple(sorted(__protobuf__.manifest))
{% endblock %}
